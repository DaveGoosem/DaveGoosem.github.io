---
title: Orchestrating Sitecore XMC with Next JS + Vercel & Storybook
date: '2025-05-24'
tags: ['XMCloud', 'Sitecore', 'Storybook', 'SaaS', 'NextJS', 'Unit Testing']
draft: false
summary: >
  Take an inside look at a battle-tested enterprise workflow that marries Sitecore XMC's composable content platform with a modern Next JS front-end running on Vercel. We'll walk through the end-to-end pipeline: spinning up XMC Docker containers for local authors, generating type-safe models, wiring components in Storybook, and driving CI/CD to Vercel Preview → Production. We'll look at some code samples, git-based branching strategies and automated visual regression tests. If you’re chasing rapid iteration without sacrificing governance, this article covers how to keep authors, designers, and engineers in lock-step - right up to that green production check-mark.
layout: DaveLayout
images: []
authors: ['default']
---

In this article we'll take an inside look at a battle-tested enterprise workflow that marries Sitecore XMC’s composable content platform with a modern Next JS front-end running on Vercel. We’ll walk through the end-to-end pipeline: spinning up XMC Docker containers for local authors, generating type-safe models, wiring components in Storybook, and driving CI/CD to Vercel Preview → Production. We'll look at some code samples, git-based branching strategies and automated visual regression tests. If you’re chasing rapid iteration without sacrificing governance, this article covers how to keep authors, designers, and engineers in lock-step - right up to that green production check-mark.

## Docker & Solution Set up

### Key concepts

See my previous articles for a detailed guide on how the solution is structured here: [Sitecore JSS Multi-Site with NPM Workspaces](https://davegoosem.com/blog/sitecore-jss-multi-site-with-npm-workspaces)

1. Docker will only contain the Sitecore instance and we'll spin up our heads and storybook on our host machine as per the link above
2. We will use a mono-repo with transpilation for ease of access to each 'package' through simple alias pathing configured in our `tsconfig.json` as per the link above
3. We will add an extra script named `add-hosts.ps1` to manage the networking from our apps running on the local machine TO our containerised local Sitecore instance. We do this by updating our local hosts file each time during `docker up` using the value we get from the docker instance

```powershell
# host.docker.internal is not available on CM, so we need to add it manually. See https://sitecore.stackexchange.com/a/35044/1278
# this custom proxy domain is used to allow us to access docker container Sitecore CM instance from our NextJS Sitecore Apps which are outside of the docker containers for our local env's

#This is another way to get the right value but Azure VMs have 3 ips so we want the DHCP address. https://learn.microsoft.com/en-us/powershell/module/nettcpip/get-netipaddress?view=windowsserver2022-ps
#$ip = Get-NetIPAddress | Where-Object -FilterScript {$_.IPAddress.StartsWith("172.")} 
$ip = Get-NetIPAddress | Where-Object -FilterScript { $_.PrefixOrigin -Eq ("Dhcp") }
$ipAddress = $ip.IPAddress
$command = "'$ipAddress host.docker.internal' | Out-File -Append -Encoding ASCII -FilePath '$($Env:windir)\system32\drivers\etc\hosts'"

$containerId = docker ps --filter name=cm-1 --format "{{.ID}}"
$containerId = $containerId.Replace("failed to get console mode for stdout: The handle is invalid.", "")
Write-Host "Adding DNS record to container $containerId. Host: host.docker.internal. IP: $ipAddress"
docker exec $containerId powershell $command
```

This needs to be run after your docker up so that it can do what we need it to do:

![Add-Hosts Script](/static/images/posts/2025/setting-up-your-xmcloud-solution-with-storybook-and-full-test-tooling/add-hosts-script.png "Add-Hosts Script")

4. We will have an additional docker script that does a faster 'up' process to speed up our workflow. This essentially is a copy of the default `up.ps1` in the Sitecore base solution but excludes the index rebuild and a few other pieces that we don't 'need' to run every time and take a long time to run.
Note: if you're using this approach, it's recommended that you run the 'full up' `up.ps1` at least once a week.

### Structuring our SCS with multi-site solutions

A couple of important design concepts and considerations we want to employ:

#### Who 'owns' what?
The Development Team are always going to 'own' Templates, Renderings, Placeholders, Layouts and Settings etc. however depending on your situation, 
the key considerations we need to make is going to be whether you are going to allow your content authors to change anything in the Presentation area of 
the Site tree? 

If you're setting up a multi-site solution with multiple site collections and sites, it's much, <i>much</i> easier to manage things in separated SCS modules/files. I really like to number the SCS Module files so they appear in the file system in the order that they need to be synced in as a visual aid to 
divide things up into logical pieces. Using the numbering currently also enforces the ordering of the sync however you will still want to make use of the 'references' configuration in your SCS Module as documented [here](https://doc.sitecore.com/xp/en/developers/latest/developer-tools/create-a-sitecore-content-serialization-module.html) to control the order that your SCS modules are synced.

We have used a simple pattern whereby we have global shared and base global pieces synced in their own modules first, followed by the shared site for each site collection and then each site's own pieces clearly defined like so:

![SCS Modules File Structure](/static/images/posts/2025/setting-up-your-xmcloud-solution-with-storybook-and-full-test-tooling/scs-modules-file-structure.png "SCS Modules File Structure")

Above you can see that we're "owning" the entire Presentation section of the tree and syncing everything in there (`ItemAndDescendants`) while we are syncing the Data folder and JUST it's direct child items (IE. the targets for all our renderings data templates) sucha that nothing WITHIN the individual data folders is synced (that's content owned by the Content Team).

The Settings area we want to use `CreateOnly` so that we can update the settings for our higher environments to use their own Domains and config.

It's all aimed at having the least amount of config in the SCS modules as possible. This is very easy but you MUST use common patterns/processes to make this work.


## Deployments to Sitecore XMC using Sitecore managed editing host


## Deployments to Vercel




- generating type-safe models, wiring components in Storybook, 
- and driving CI/CD to Vercel Preview → Production. 
- We'll look at some code samples, git-based branching strategies and automated visual regression tests. 




### Using Page Branch & Branch Templates and Shared Layout to Improve Development and Authoring Workflows